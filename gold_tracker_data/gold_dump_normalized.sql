-- COMP1314 Coursework - Normalized Gold Price Database
-- Clean SQL demonstrating normalization concept
-- Initial creation: 2025-12-24 04:39:18

-- Create fresh database
DROP DATABASE IF EXISTS comp1314_db;
CREATE DATABASE comp1314_db;
USE comp1314_db;

-- ============================================
-- TABLE 1: Daily price ranges (Normalized)
-- Stores day's range once per day (1NF, 2NF, 3NF)
-- ============================================
CREATE TABLE daily_ranges (
    date DATE PRIMARY KEY,           -- Natural primary key
    day_low DECIMAL(10,2) NOT NULL,
    day_high DECIMAL(10,2) NOT NULL,
    range_spread DECIMAL(10,2) AS (day_high - day_low),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ============================================
-- TABLE 2: Price observations (Normalized)
-- Stores multiple price observations per day
-- References daily_ranges via date foreign key
-- ============================================
CREATE TABLE gold_prices (
    price_id INT AUTO_INCREMENT PRIMARY KEY,
    timestamp DATETIME NOT NULL,
    bid_price DECIMAL(10,2) NOT NULL,
    ask_price DECIMAL(10,2) NOT NULL,
    spread DECIMAL(10,2) AS (ask_price - bid_price),
    change_amount DECIMAL(10,2),
    change_percent DECIMAL(10,4),
    date DATE NOT NULL,              -- Foreign key to daily_ranges
    source VARCHAR(50) DEFAULT 'kitco',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE KEY idx_unique_timestamp (timestamp, source),
    FOREIGN KEY (date) REFERENCES daily_ranges(date)
);

-- ============================================
-- INSERT ALL DATA
-- Multi-row INSERT format
-- ============================================

-- Daily ranges (one per day)
INSERT INTO daily_ranges (date, day_low, day_high) VALUES
('2025-12-24', 4430.40, 4498.60),
('2025-12-24', 4430.40, 4500.50),
('2025-12-24', 4471.80, 4525.80),
('2025-12-24', 4462.90, 4525.80),
('2025-12-25', 4449.20, 4525.80),
('2026-02-03', 4404.00, 4885.70),
('2026-02-03', 4659.90, 4933.90),
('2026-02-04', 4659.90, 5066.00),
('2026-02-04', 4659.90, 5074.60),
('2026-02-04', 4910.90, 5091.30),
('2026-02-04', 4910.90, 5092.70),
('2026-02-05', 4857.50, 5092.70),
('2026-02-05', 4808.80, 5092.70),
('2026-02-10', 4988.50, 5076.30),
('2026-02-11', 4988.50, 5079.30),
('2026-02-11', 5025.20, 5070.20),
('2026-02-12', 5017.90, 5117.80),
('2026-02-12', 5044.80, 5101.10);

-- Gold price observations (multiple per day)
INSERT INTO gold_prices (timestamp, bid_price, ask_price, change_amount, change_percent, date, source) VALUES
('2025-12-24 04:39:17', 4490.40, 4492.40, +47.80, +1.08, '2025-12-24', 'kitco'),
('2025-12-24 04:42:03', 4489.00, 4491.00, +46.40, +1.04, '2025-12-24', 'kitco'),
('2025-12-24 05:06:06', 4492.80, 4494.80, +50.20, +1.13, '2025-12-24', 'kitco'),
('2025-12-24 13:01:13', 4497.60, 4499.60, +13.90, +0.31, '2025-12-24', 'kitco'),
('2025-12-24 13:04:04', 4499.70, 4501.70, +16.00, +0.36, '2025-12-24', 'kitco'),
('2025-12-24 13:05:04', 4499.70, 4501.70, +16.00, +0.36, '2025-12-24', 'kitco'),
('2025-12-24 13:06:04', 4495.20, 4497.20, +11.50, +0.26, '2025-12-24', 'kitco'),
('2025-12-24 14:00:04', 4488.70, 4490.70, +5.00, +0.11, '2025-12-24', 'kitco'),
('2025-12-24 15:00:04', 4493.20, 4495.20, +9.50, +0.21, '2025-12-24', 'kitco'),
('2025-12-24 16:00:04', 4483.20, 4485.20, -0.50, -0.01, '2025-12-24', 'kitco'),
('2025-12-24 17:00:05', 4482.00, 4484.00, -1.70, -0.04, '2025-12-24', 'kitco'),
('2025-12-24 18:00:05', 4493.90, 4495.90, +10.20, +0.23, '2025-12-24', 'kitco'),
('2025-12-24 19:00:05', 4488.60, 4490.60, +4.90, +0.11, '2025-12-24', 'kitco'),
('2025-12-24 20:00:06', 4490.60, 4492.60, +6.90, +0.15, '2025-12-24', 'kitco'),
('2025-12-24 21:00:06', 4490.90, 4492.90, +7.20, +0.16, '2025-12-24', 'kitco'),
('2025-12-24 22:00:06', 4485.80, 4487.80, +2.10, +0.05, '2025-12-24', 'kitco'),
('2025-12-24 23:00:07', 4466.60, 4468.60, -17.10, -0.38, '2025-12-24', 'kitco'),
('2025-12-25 00:00:06', 4458.50, 4460.50, -25.20, -0.56, '2025-12-25', 'kitco'),
('2025-12-25 01:00:06', 4476.80, 4478.80, -6.90, -0.15, '2025-12-25', 'kitco'),
('2025-12-25 02:00:05', 4478.80, 4480.80, -4.90, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 03:00:06', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 04:00:06', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 05:00:06', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 06:00:06', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 07:00:07', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 08:00:06', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 09:00:06', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 10:00:07', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 11:00:07', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 12:00:07', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 13:00:08', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 14:00:07', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 15:00:08', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 16:00:08', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2025-12-25 17:00:48', 4478.60, 4480.60, -5.10, -0.11, '2025-12-25', 'kitco'),
('2026-02-03 12:00:04', 4805.00, 4807.00, +146.30, +3.14, '2026-02-03', 'kitco'),
('2026-02-03 16:00:05', 4916.90, 4918.90, +258.20, +5.54, '2026-02-03', 'kitco'),
('2026-02-04 11:00:05', 5043.10, 5045.10, +97.30, +1.97, '2026-02-04', 'kitco'),
('2026-02-04 12:00:05', 5066.90, 5068.90, +121.10, +2.45, '2026-02-04', 'kitco'),
('2026-02-04 14:00:02', 5077.50, 5079.50, +131.70, +2.66, '2026-02-04', 'kitco'),
('2026-02-04 15:00:05', 5074.90, 5076.90, +129.10, +2.61, '2026-02-04', 'kitco'),
('2026-02-04 17:00:02', 5084.10, 5086.10, +138.30, +2.80, '2026-02-04', 'kitco'),
('2026-02-05 10:00:05', 4961.20, 4963.20, -2.60, -0.05, '2026-02-05', 'kitco'),
('2026-02-05 11:00:05', 4839.60, 4841.60, -124.20, -2.50, '2026-02-05', 'kitco'),
('2026-02-10 14:00:05', 5039.10, 5041.10, -19.30, -0.38, '2026-02-10', 'kitco'),
('2026-02-10 15:00:05', 5025.90, 5027.90, -32.50, -0.64, '2026-02-10', 'kitco'),
('2026-02-11 11:00:07', 5053.30, 5055.30, +28.50, +0.57, '2026-02-11', 'kitco'),
('2026-02-11 16:00:05', 5053.80, 5055.80, +29.00, +0.58, '2026-02-11', 'kitco'),
('2026-02-12 11:00:05', 5066.00, 5068.00, -17.10, -0.34, '2026-02-12', 'kitco'),
('2026-02-12 12:00:07', 5055.40, 5057.40, -27.70, -0.54, '2026-02-12', 'kitco'),
('2026-02-12 13:00:04', 5066.00, 5068.00, -17.10, -0.34, '2026-02-12', 'kitco'),
('2026-02-12 14:00:05', 5071.60, 5073.60, -11.50, -0.23, '2026-02-12', 'kitco');

